{% extends "base.html" %}

{% block title %}Cat√°logo{% endblock %}

{% block content %}
<div class="container py-4">

    <h2 class="mb-4">Cat√°logo de productos</h2>

    <div class="row g-4">

        {% for item in productos %}
        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
            <a href="{% url 'detalle_producto' item.producto.id %}" class="text-decoration-none text-dark">
                <div class="card h-100 shadow-sm">

<div class="position-relative">

  {# ‚ù§Ô∏è CORAZ√ìN ‚Äî SIEMPRE VISIBLE #}
  {% with favs=request.session.favoritos %}
    {% if favs and item.producto.id|stringformat:"s" in favs %}
      <a
        href="{% url 'eliminar_favorito' item.producto.id %}?next={{ request.path }}"
        class="btn btn-light position-absolute top-0 end-0 m-2 rounded-circle shadow-sm"
        title="Quitar de favoritos"
        onclick="event.stopPropagation();"
      >
        <i class="fa-solid fa-heart text-danger"></i>
      </a>
    {% else %}
      <a
        href="{% url 'agregar_favorito' item.producto.id %}?next={{ request.path }}"
        class="btn btn-light position-absolute top-0 end-0 m-2 rounded-circle shadow-sm"
        title="Agregar a favoritos"
        onclick="event.stopPropagation();"
      >
        <i class="fa-regular fa-heart"></i>
      </a>
    {% endif %}
  {% endwith %}

  {# üñºÔ∏è IMAGEN O PLACEHOLDER #}
  {% if item.producto.imagen %}
    <img
      src="{{ item.producto.imagen.url }}"
      class="card-img-top"
      style="height:200px; object-fit:contain;"
    >
  {% else %}
    <div class="d-flex justify-content-center align-items-center bg-light"
         style="height:200px;">
      <span class="text-muted">Sin imagen</span>
    </div>
  {% endif %}

</div>


                    <div class="card-body">
                        <h6 class="card-title">
                            {{ item.producto.nombre_publico }}
                        </h6>

                        {% if item.oferta %}
                            <span class="text-muted text-decoration-line-through">
                                ${{ item.precio_original }}
                            </span><br>
                            <span class="fw-bold text-success">
                                ${{ item.precio_final }}
                            </span>
                        {% else %}
                            <span class="fw-bold text-success">
                                ${{ item.precio_original }}
                            </span>
                        {% endif %}
                    </div>

                </div>
            </a>
        </div>
        {% endfor %}

    </div>
</div>
{% endblock %}
